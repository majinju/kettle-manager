///<jscompress sourcefile="eova.common.js" />
(function(a){a.extend({extendPrototype:function(a,b){var d=function(){};d.prototype=b.prototype;a.prototype=new d;a.prototype.constructor=a},getHtmlOptions:function(a){var b=void 0;(a=a.$dom.data("options"))&&(b=eval("({"+a+"})"));return b},eovaInit:function(c,b,d,e){var f=[];c.each(function(){var c=a.data(this,d);c||(c=new b(this,e),a.data(this,d,c));f.push(c)});return 1==f.length?f[0]:f},tipwarn:function(c,b){var d=c.tooltip({position:"bottom",deltaY:-6,showEvent:null,hideEvent:"mousemove",content:'\x3cspan\x3e\x3cspan class\x3d"pd5 icon-exclamation"\x3e\x26nbsp;\x3c/span\x3e'+b+"\x3c/span\x3e",onShow:function(){a(this).tooltip("tip").css({border:"1px solid transparent","background-color":"#fffcef","border-color":"#ffbb76",color:"#db7c22"})}}).tooltip("show");setTimeout(function(){d.tooltip("destroy")},3E3);return d},validation:function(c,b){if(!b.isValid){var d=a.tipwarn(a(b.element).parent(),b.msg);a(b.element).keydown(function(e){d.tooltip("destroy");a(this).unbind("keydown")})}},slideMsg:function(c,b){var d=a;b&&(d=b);d.messager.show({title:"\u64cd\u4f5c\u63d0\u793a",msg:c,timeout:1500,showType:"slide"})},alert:function(a,b){b&&null!=b&&""!=b||(b="\u670d\u52a1\u5f02\u5e38\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\uff01");b.startsWith("info")?(b=b.replace("info:",""),a.messager.alert("\u63d0\u793a",b,"info")):b.startsWith("warn")?(b=b.replace("warn:",""),a.messager.alert("\u8b66\u544a",b,"warning")):(b.startsWith("error")&&(b=b.replace("error:","")),a.messager.alert("\u9519\u8bef",b,"error"))},gridToExcel:function(){var a=function(a,d){return a.replace(/{(\w+)}/g,function(a,b){return d[b]})};return function(b,d){for(var e="\x3ctr\x3e",f=b.datagrid("getColumnFields"),g=0;g<f.length;g++){var h=f[g];console.log(h);"ck"!=h&&((h=b.datagrid("getColumnOption",h).title)||(h=""),e=e+"\x3ctd\x3e"+h+"\x3c/td\x3e")}for(var e=e+"\x3c/tr\x3e",l=b.datagrid("getRows"),k=0;k<l.length;k++){var m=l[k];console.log(m);e+="\x3ctr\x3e";for(g=0;g<f.length;g++)h=f[g],"ck"!=h&&(e=e+"\x3ctd\x3e"+m[h]+"\x3c/td\x3e");e+="\x3c/tr\x3e"}f=window.location;e=a('\x3chtml xmlns:o\x3d"urn:schemas-microsoft-com:office:office" xmlns:x\x3d"urn:schemas-microsoft-com:office:excel" xmlns\x3d"http://www.w3.org/TR/REC-html40"\x3e\x3chead\x3e\x3c!--[if gte mso 9]\x3e\x3cxml\x3e\x3cx:ExcelWorkbook\x3e\x3cx:ExcelWorksheets\x3e\x3cx:ExcelWorksheet\x3e\x3cx:Name\x3e{worksheet}\x3c/x:Name\x3e\x3cx:WorksheetOptions\x3e\x3cx:DisplayGridlines/\x3e\x3c/x:WorksheetOptions\x3e\x3c/x:ExcelWorksheet\x3e\x3c/x:ExcelWorksheets\x3e\x3c/x:ExcelWorkbook\x3e\x3c/xml\x3e\x3c![endif]--\x3e\x3c/head\x3e\x3cbody\x3e\x3ctable\x3e{table}\x3c/table\x3e\x3c/body\x3e\x3c/html\x3e',{worksheet:d||"Worksheet",table:e});e=window.btoa(unescape(encodeURIComponent(e)));f.href="data:application/vnd.ms-excel;base64,"+e}}(),clipStr:function(a,b){for(var d="",e=0;e<a.length;e++)if(d+=a.charAt(e),e+1==b)return d+"...";return d}});a.extend(a.fn.datagrid.defaults.editors,{eovatext:{init:function(c,b){var d=a('\x3cdiv class\x3d"eova-text" name\x3d"'+b.name+'"\x3e\x3c/div\x3e').appendTo(c);d.eovatext(b);return d},getValue:function(c){return a(c).eovatext().getValue()},setValue:function(c,b){a(c).eovatext().setValue(b)},resize:function(c,b){a(c).eovatext().setWidth(b)}},eovatime:{init:function(c,b){var d=a('\x3cdiv class\x3d"eova-time"\x3e\x3c/div\x3e').appendTo(c);d.eovatime(b);return d},getValue:function(c){return a(c).eovatime().getValue()},setValue:function(c,b){a(c).eovatime().setValue(b)},resize:function(c,b){a(c).eovatime().setWidth(b)}},eovacombo:{init:function(c,b){var d=a('\x3cdiv class\x3d"eova-combo"\x3e\x3c/div\x3e').appendTo(c);d.eovacombo(b);return d},destroy:function(c){a(c).eovacombo().destroy()},getText:function(c){return a(c).eovacombo().getText()},getValue:function(c){return a(c).eovacombo().getValue()},setValue:function(c,b){var d=[];b&&""!=b&&(d=-1==b.indexOf(",")?[b]:b.split(","));a(c).eovacombo().setTexts(d)},resize:function(c,b){a(c).eovacombo().setWidth(b)}},eovafind:{init:function(c,b){var d=a('\x3cdiv class\x3d"eova-find"\x3e\x3c/div\x3e').appendTo(c);d.eovafind(b);return d},getText:function(c){return a(c).eovafind().getText()},getValue:function(c){return a(c).eovafind().getValue()},setValue:function(c,b){a(c).eovafind().setText(b)},resize:function(c,b){a(c).eovafind().setWidth(b)}},eovacheck:{init:function(c,b){var d=a('\x3cdiv class\x3d"eova-check"\x3e\x3c/div\x3e').appendTo(c);d.eovacheck(b);return d},getValue:function(c){return a(c).eovacheck().getChecked()},setValue:function(c,b){a(c).eovacheck().setChecked(b)},resize:function(a,b){}}});a.extend(a.fn.datagrid.methods,{editCell:function(c,b){return c.each(function(){a(this).datagrid("options");for(var d=a(this).datagrid("getColumnFields",!0).concat(a(this).datagrid("getColumnFields")),e=0;e<d.length;e++){var f=a(this).datagrid("getColumnOption",d[e]);f.editor1=f.editor;d[e]!=b.field&&(f.editor=null)}a(this).datagrid("beginEdit",b.index);(e=a(this).datagrid("getEditor",b))&&(a(e.target).hasClass("textbox-f")?a(e.target).textbox("textbox").focus():a(e.target).focus());for(e=0;e<d.length;e++)f=a(this).datagrid("getColumnOption",d[e]),f.editor=f.editor1})},enableCellEditing:function(c){return c.each(function(){var b=a(this),d=b.datagrid("options");d.oldOnClickCell=d.onClickCell;d.onClickCell=function(e,f){if(void 0!=d.editIndex)if(b.datagrid("validateRow",d.editIndex)){if(!a("#"+d.id).parent().isValid())return;b.datagrid("endEdit",d.editIndex);d.editIndex=void 0}else return;b.datagrid("selectRow",e).datagrid("editCell",{index:e,field:f});d.editIndex=e;d.oldOnClickCell.call(this,e,f)}})}});a.fn.mask=function(){1!=a(this).data("mask")&&(a(this).wrap('\x3cspan style\x3d"position: relative"\x3e\x3c/span\x3e'),a(this).parent().append('\x3cdiv class\x3d"divMask" style\x3d"position: absolute; width: 100%; height: 22px; left: 0px; top: -3px; background: #DADADA; opacity: 0.5; filter: alpha(opacity\x3d0)"\x3e \x3c/div\x3e'),a(this).data("mask",1))};a.fn.unmask=function(){1==a(this).data("mask")&&(a(this).parent().find(".divMask").remove(),a(this).unwrap(),a(this).data("mask",0))}})(jQuery);(function(a){TEXTBOX="textbox";a.fn.eovatext=function(b){var d=[];this.each(function(){var e=a.data(this,TEXTBOX);e?a.extend(e.options,b):(e=new c(this,b),e.render(),e.bindEvents());a.data(this,TEXTBOX,e);d.push(e)});return 1==d.length?d[0]:d};var c=a.fn.eovatext.TextBox=function(b,d){this.$dom=a(b);this.defaults={width:180,btnTitle:"\u70b9\u51fb\u6e05\u7a7a\u6587\u672c",btnIcon:"",isReadonly:!1,disable:!1,required:!1};this.options=a.extend({},this.defaults,a.getHtmlOptions(this),d);this.name=this.$dom.attr("name");this.$dom.removeAttr("name");this.value=this.$dom.attr("value");this.$dom.removeAttr("value");console.log(this.options)};c.prototype.render=function(){var b=a("\x3cinput type\x3d'text' autocomplete\x3d'off' /\x3e").appendTo(this.$dom),d=a("\x3ci class\x3d'ei'\x3e\x3c/i\x3e").appendTo(this.$dom);d.attr("title",this.options.btnTitle);this.name&&b.attr("name",this.name);this.value&&b.attr("value",this.value);this.options.placeholder&&b.attr("placeholder",this.options.placeholder);this.options.required&&b.attr("required","required");this.options.isReadonly&&(b.attr("readonly","readonly"),b.css("cursor","pointer"));this.options.disable&&this.$dom.mask();this.$textbox=b;this.$btn=d;this.setWidth(this.options.width)};c.prototype.bindEvents=function(){var a=this.$textbox;this.$btn.bind("click",function(){a.val("")})};c.prototype.getValue=function(){return this.$textbox.val()};c.prototype.setValue=function(a){this.$textbox.val(a)};c.prototype.getWidth=function(){return this.options.width+20};c.prototype.setWidth=function(a){this.$textbox.outerWidth(a-22)};c.prototype.readonly=function(a){a&&this.$textbox.attr("readonly",!0)}})(jQuery);(function(a){function c(a,b){if(a.options.multiple){for(var d=a.getValues(),c=0;c<d.length;c++)if(d[c]==b)return;d.push(b);a.setValues(d)}else a.setValues([b])}var b=a.fn.eovatext.TextBox;COMBOBOX="combobox";a.fn.eovacombo=function(e){var b=[];this.each(function(){var c=a.data(this,COMBOBOX);c?a.extend(c.options,e):(c=new d(this,e),c.render(),c.reload(),c.bindEvents());a.data(this,COMBOBOX,c);b.push(c)});return 1==b.length?b[0]:b};var d=a.fn.eovacombo.ComboBox=function(e,d){b.apply(this,arguments);this.defaults={btnTitle:"\u70b9\u51fb\u9009\u62e9\u5185\u5bb9",btnIcon:"",isReadonly:!0,multiple:!1,separator:",",editable:!0,valueField:"id",textField:"cn",onChange:function(a,e){}};this.options=a.extend({},this.options,this.defaults,a.getHtmlOptions(this),d);console.log(this.options)};a.extendPrototype(d,b);d.prototype.render=function(){var e=a("\x3cinput type\x3d'hidden' /\x3e").appendTo(this.$dom),b=a("\x3cinput type\x3d'text' /\x3e").appendTo(this.$dom),d=a("\x3ci class\x3d'ei'\x3e\x3c/i\x3e").appendTo(this.$dom),c=a("\x3cdiv class\x3d'eova-combo-panel'\x3e\x3c/div\x3e").appendTo("body");d.attr("title",this.options.btnTitle);c.css("cursor","pointer");this.name&&e.attr("name",this.name);this.value&&e.attr("value",this.value);this.options.placeholder&&b.attr("placeholder",this.options.placeholder);this.options.required&&b.attr("required","required");this.options.disable&&this.$dom.mask();this.options.isReadonly&&(b.attr("readonly","readonly"),b.css("cursor","pointer"),b.attr("title",this.options.btnTitle));this.$valuebox=e;this.$textbox=b;this.$btn=d;this.$panel=c;this.setWidth(this.options.width)};d.prototype.bindEvents=function(){var b=this.$textbox,d=this.$panel;d.unbind(".eovacombo");this.$dom.click(function(c){a(".eova-combo-panel").is(":visible")&&a(".eova-combo-panel").hide();var h=b.offset();d.css({position:"absolute",left:h.left-1,top:h.top+21,height:200,overflow:"auto",width:a(this).width()});d.show();console.log(".eova-combo click");c.stopPropagation()});d.bind("mousedown.eovacombo",function(a){return!1});a(document).unbind(".eovacombo").bind("mousedown.eovacombo",function(b){a(".eova-combo-panel").is(":visible")&&a(".eova-combo-panel").hide()})};d.prototype.destroy=function(){this.$dom.remove();this.$panel.remove()};d.prototype.reload=function(){var b=this,d=this.options,g=d.url;g||(g=this.$dom.attr("url"));g?a.ajax({type:"get",async:!0,url:g,dataType:"json",success:function(g){b.$panel.empty();a.each(g,function(c,g){var h=a.clipStr(g[d.textField],11);a('\x3cdiv value\x3d"'+g[d.valueField]+'"\x3e'+h+"\x3c/div\x3e").appendTo(b.$panel)});b.$panel.children("div").unbind(".eovacombo").bind("mousedown.eovacombo",function(g){var h=a(this),m=h.attr("value");if(d.multiple)if(h.hasClass("eova-combo-selected"))for(var h=b.getValues(),n=0;n<h.length;n++){if(h[n]==m){h.splice(n,1);b.setValues(h);break}}else c(b,m);else c(b,m),b.$panel.hide();console.log("reload combo panel div click");g.stopPropagation()});b.getValue()&&(d.multiple?b.setValues(b.getValues()):b.setValue(b.getValue()));a.data(this,COMBOBOX,b)},error:function(){alert("\u4e0b\u62c9\u6846\u52a0\u8f7d\u6570\u636e\u5931\u8d25,URL\x3d"+g)}}):a("\x3cdiv\x3e\u6570\u636e\u672a\u52a0\u8f7d\x3c/div\x3e").appendTo(b.$panel)};d.prototype.getValue=function(){return this.$valuebox.val()};d.prototype.getValues=function(){var a=this.$valuebox.val();return""==a?[]:a.split(this.options.separator)};d.prototype.setValue=function(a){this.setValues([a])};d.prototype.setValues=function(a){this.$panel.children().removeClass("eova-combo-selected");for(var b=[],d=[],c=0;c<a.length;c++){var l=a[c],k=this.$panel.children("div[value\x3d'"+l+"']");b.push(l);d.push(k.text());k.addClass("eova-combo-selected")}c=this.getValues();this.$valuebox.val(b.join(this.options.separator));this.$textbox.val(d.join(this.options.separator));b=this.options;b.multiple?a.length!=c.length&&b.onChange.call(this.$dom,c,a):a[0]!=c[0]&&b.onChange.call(this.$dom,c[0],a[0])};d.prototype.getText=function(){return this.$textbox.val()};d.prototype.getTexts=function(){var a=this.$textbox.val();return""==a?[]:a.split(this.options.separator)};d.prototype.setText=function(a){return this.setTexts([a])};d.prototype.setTexts=function(a){this.$panel.children().removeClass("eova-combo-selected");for(var b=[],d=[],c=0;c<a.length;c++){var l=a[c],k=this.$panel.children("div:contains('"+l+"')");b.push(k.attr("value"));d.push(l);k.addClass("eova-combo-selected")}this.$valuebox.val(b.join(this.options.separator));this.$textbox.val(d.join(this.options.separator))}})(jQuery);(function(a){var c=a.fn.eovatext.TextBox;FINDBOX="findbox";a.fn.eovafind=function(d){var c=[];this.each(function(){var g=a.data(this,FINDBOX);g?a.extend(g.options,d):(g=new b(this,d),g.render(),g.bindEvents(),g.init());a.data(this,FINDBOX,g);c.push(g)});return 1==c.length?c[0]:c};var b=a.fn.eovafind.FindBox=function(b,d){c.apply(this,arguments);this.defaults={width:180,btnTitle:"\u70b9\u51fb\u67e5\u627e\u5185\u5bb9",isReadonly:!0,onChange:function(a,b){}};this.options=a.extend({},this.options,this.defaults,a.getHtmlOptions(this),d);this.code=this.$dom.attr("code");this.$dom.removeAttr("code");this.field=this.$dom.attr("field");this.$dom.removeAttr("field")};a.extendPrototype(b,c);b.prototype.render=function(){var b=a("\x3cinput type\x3d'hidden' /\x3e").appendTo(this.$dom),d=a("\x3cinput type\x3d'text' /\x3e").appendTo(this.$dom),c=a("\x3ci class\x3d'ei'\x3e\x3c/i\x3e").appendTo(this.$dom);c.attr("title",this.options.btnTitle);this.name&&b.attr("name",this.name);this.value&&b.val(this.value);this.options.placeholder&&d.attr("placeholder",this.options.placeholder);this.options.required&&d.attr("required","required");this.options.disable&&this.$dom.mask();d.attr("readonly","readonly");d.css("cursor","pointer");d.attr("title",this.options.btnTitle);this.$valuebox=b;this.$textbox=d;this.$btn=c;this.setWidth(this.options.width)};b.prototype.init=function(){var b=this.$textbox;this.$valuebox.val()&&a.ajax({url:"/widget/findCnByEn/"+this.code+"-"+this.field+"-"+this.value,dataType:"json",success:function(d){var c=d.text_field,h=[];a.each(eval(d.data),function(a,b){h.push(b[c])});b.val(h.join(","))}})};b.prototype.bindEvents=function(){var a=this,b=this.options,c=this.$textbox,h=this.$dom;this.$textbox.bind("click",function(){var c=h.attr("url");c||(c=b.url);d(a,c)});this.$btn.bind("click",function(){c.trigger("click")})};b.prototype.getValue=function(){return this.$valuebox.val()};b.prototype.setValue=function(a){this.$valuebox.val(a)};b.prototype.getText=function(){return this.$textbox.val()};b.prototype.setText=function(a){this.$textbox.val(a)};var d=function(a,b){var d=parent.sy.modalDialog({title:"\u8bf7\u9009\u62e9\u6570\u636e",url:b,buttons:[{id:"find_ok",text:"\u786e\u5b9a",handler:function(){d.find("iframe").get(0).contentWindow.selectData(d,a);window.focus()}}]},650,600)}})(jQuery);(function(a){var c=a.fn.eovatext.TextBox;AUTOBOX="autobox";a.fn.eovaauto=function(d){var c=[];this.each(function(){var f=a.data(this,AUTOBOX);f?a.extend(f.options,d):(f=new b(this,d),f.render(),f.$textbox.css("background-color","#EBEBE4"),f.bindEvents());a.data(this,AUTOBOX,f);c.push(f)});return 1==c.length?c[0]:c};var b=a.fn.eovaauto.AutoBox=function(b,e){c.apply(this,arguments);this.defaults={btnTitle:"\u81ea\u589e\u957f\u5b57\u6bb5",disable:!0};this.options=a.extend({},this.options,this.defaults,e)};a.extendPrototype(b,c);b.prototype.bindEvents=function(){}})(jQuery);(function(a){var c=a.fn.eovatext.TextBox;ICONBOX="iconbox";a.fn.eovaicon=function(d){var c=[];this.each(function(){var f=a.data(this,ICONBOX);f?a.extend(f.options,d):(f=new b(this,d),f.render(),f.bindEvents());a.data(this,ICONBOX,f);c.push(f)});return 1==c.length?c[0]:c};var b=a.fn.eovaicon.IconBox=function(b,e){c.apply(this,arguments);this.defaults={btnTitle:"\u70b9\u51fb\u9009\u62e9\u56fe\u6807",isReadonly:!0};this.options=a.extend({},this.options,this.defaults,e)};a.extendPrototype(b,c);b.prototype.bindEvents=function(){var a=this.$textbox,b=this.$btn;b.bind("click",function(){b.addClass("ext-icon-zoom");eova_iconDialog(a,b)});this.$textbox.bind("click",function(){b.trigger("click")})}})(jQuery);(function(a){var c=a.fn.eovatext.TextBox;TIMEBOX="timebox";a.fn.eovatime=function(d){var c=[];this.each(function(){var f=a.data(this,TIMEBOX);f?a.extend(f.options,d):(f=new b(this,d),f.render(),f.bindEvents(),f.$dom.attr("onClick","WdatePicker({dateFmt:'"+f.options.format+"'})"));a.data(this,TIMEBOX,f);c.push(f)});return 1==c.length?c[0]:c};var b=a.fn.eovatime.TimeBox=function(b,e){c.apply(this,arguments);this.defaults={btnTitle:"\u70b9\u51fb\u9009\u62e9\u65f6\u95f4",isReadonly:!0,format:"yyyy-MM-dd HH:mm:ss"};this.options=a.extend({},this.options,this.defaults,a.getHtmlOptions(this),e)};a.extendPrototype(b,c);b.prototype.bindEvents=function(){var a=this.$textbox;this.$btn.bind("click",function(){a.trigger("click")})}})(jQuery);(function(a){CHECKBOX="checkbox";a.fn.eovacheck=function(b){var d=[];this.each(function(){var e=a.data(this,CHECKBOX);e?a.extend(e.options,b):(e=new c(this,b),e.render());a.data(this,CHECKBOX,e);d.push(e)});return 1==d.length?d[0]:d};var c=a.fn.eovacheck.CheckBox=function(b,c){this.$dom=a(b);this.defaults={isCheck:!1,disable:!1};var e=void 0,f=this.$dom.data("options");f&&(e=eval("({"+f+"})"),this.$dom.removeAttr("data-options"));this.options=a.extend({},this.defaults,e,c);this.name=this.$dom.attr("name");this.value=this.$dom.attr("value")};c.prototype.render=function(){var b=a("\x3cinput type\x3d'checkbox' /\x3e").appendTo(this.$dom);this.name&&b.attr("name",this.name);this.value&&b.attr("value",this.value);this.options.isCheck&&this.setChecked(!0);this.options.disable&&b.attr("disabled","disabled");this.$checkbox=b};c.prototype.getChecked=function(){return this.$checkbox.prop("checked")};c.prototype.setChecked=function(a){this.$checkbox.prop("checked",a)};c.prototype.readonly=function(a){a&&this.$checkbox.attr("readonly",!0)}})(jQuery);